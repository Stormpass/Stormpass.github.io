(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49866164"],{"2b2e":function(t,e,n){"use strict";n("7b8f")},"33f5":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"list-header flex y-center"},[n("a-button",{attrs:{icon:"plus-circle",type:"primary"},on:{click:t.addPlan}},[t._v("添加计划")])],1),n("div",{staticClass:"plan-list"},[n("a-list",{staticClass:"plan-list-container",attrs:{"item-layout":"horizontal","data-source":t.list},scopedSlots:t._u([{key:"renderItem",fn:function(e){return n("plan-item",{attrs:{"no-child":"",item:e},on:{removed:t.handleRemoved}})}}])})],1)])},o=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"multi-form"},[n("a-form-model",t._b({attrs:{form:t.form,layout:"horizontal"}},"a-form-model",t.formItemLayout,!1),[n("a-form-model-item",{attrs:{label:"计划类型"}},[n("a-radio-group",{attrs:{"button-style":"solid"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[n("a-radio-button",{attrs:{value:0}},[t._v(" 普通计划 ")]),n("a-radio-button",{attrs:{value:1}},[t._v(" 周计划 ")]),n("a-radio-button",{attrs:{value:2}},[t._v(" 月计划 ")])],1)],1),n("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:t.form.name||0===t.form.type,expression:"form.name || form.type === 0"}],attrs:{label:"计划名称"}},[n("a-input",{attrs:{disabled:0!==t.form.type},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("a-form-model-item",{attrs:{label:"开始时间",required:""}},[n("a-date-picker",{staticStyle:{width:"100%"},model:{value:t.form.begintime,callback:function(e){t.$set(t.form,"begintime",e)},expression:"form.begintime"}})],1),n("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:t.form.begintime,expression:"form.begintime"}],attrs:{label:"结束时间"}},[n("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:0!==t.form.type},model:{value:t.form.endtime,callback:function(e){t.$set(t.form,"endtime",e)},expression:"form.endtime"}})],1),n("a-form-model-item",{attrs:{label:"负责人"}},[n("span",[t._v(t._s(t.form.charger))]),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseCharger()}}},[t._v("选择负责人")])],1),n("a-form-model-item",{attrs:{label:"确认人"}},[t._l(t.form.confirmer,(function(e){return n("span",{key:e},[t._v(t._s(e))])})),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseConfirmer()}}},[t._v("选择确认人")])],2),n("a-form-model-item",{attrs:{label:"其他描述"}},[n("a-textarea",{attrs:{rows:2,placeholder:"please enter description"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),n("storm-footer",{attrs:{loading:t.submiting},on:{ok:t.handleOk,cancel:function(e){return t.$emit("cancel")}}})],1)],1)},a=[],s=n("ed08"),c=n("c1df"),l=n.n(c),u=n("956a"),f=n("ad5c");function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var p={props:{afterFormMounted:{type:Function,default:function(){}},onEnd:{type:Function,default:function(){}}},data:function(){return{form:new f["a"],objName:"plandoc",childObjName:"workdoc",formItemLayout:{labelCol:{span:4},wrapperCol:{span:14}},submiting:!1}},watch:{"form.begintime":function(){this.form._id||this.calcEndTime()},"form.type":function(t){0!==t&&this.calcEndTime()}},methods:{calcEndTime:function(){if(this.form.begintime){var t=l()(this.form.begintime),e=this.$d.user.name,n=null;1===this.form.type?(n=t.clone().add(1,"week"),this.form.endtime=n,this.form.name=e+"-周计划 "+t.format("YYYY-MM-DD")+"至"+n.format("YYYY-MM-DD")):2===this.form.type&&(n=t.clone().add(1,"month").subtract(1,"day"),this.form.endtime=n,this.form.name=e+"-月计划 "+t.format("YYYY-MM-DD")+"至"+n.format("YYYY-MM-DD"))}},addWorkItem:function(){var t=this;this.handleOk((function(e,n){if(!e&&n.body){var r=n.body.data;t.form._id=r[0]._id,t.openAddWorkForm()}}))},openAddWorkForm:function(){var t=this;this.$appLayout.showDrawer({title:"添加任务",content:u["a"],onSuccess:function(){t.loadWorks()}})},initForm:function(t){var e=t.project,n=t.parentWork;this.form.project=e,this.form.parentWork=n},reset:function(){this.form.resetFields()},chooseCharger:function(){var t=this;this.choosePeoples(!1,(function(e){e.length>0&&(t.form.charger=e[0].userid)}))},chooseConfirmer:function(){var t=this;this.choosePeoples(!0,(function(e){t.form.confirmer=e.map((function(t){return t.userid}))}))},choosePeoples:function(t,e){var n=Object(s["a"])();n.choosePeoples(t,e)},handleOk:function(){var t=this,e=d({},this.form);e.begintime&&(e.begintime=e.begintime.valueOf()),e.endtime&&(e.endtime=e.endtime.valueOf());var n=this.form._id;this.submiting=!0;var r=n?this.$http.updateOne(this.objName,e):this.$http.createOne(this.objName,e);r.end((function(e,r){if(t.submiting=!1,e&&console.log("err",e),t.onEnd&&t.onEnd(e,r),!n&&!e){var o=r.body.data[0],i=Object(s["a"])();i.notifyChargerCreate({_id:o._id,obj:t.objName})}}))}}},b=p,v=n("2877"),y=Object(v["a"])(b,i,a,!1,null,null,null),g=y.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"anim mb5 flex y-center between plan-item hover-shadow reset-listitem-extra"},[n("div",[n("div",{staticClass:"title link anim flex y-center",on:{click:t.gotoDetail}},[n("span",{staticClass:"mr10"},[t._v(t._s(t.item.name))]),n("a-tag",{attrs:{color:t.getTagConf(t.item).color}},[t._v(t._s(t.getTagConf(t.item).label))])],1),n("div",{staticClass:"flex y-center f-12"},[t.item.charger?n("div",{staticClass:"mr5"},[t._v("负责人: "+t._s(t.item.charger))]):t._e(),t.item.confirmer?n("div",[t._v("确认人: "+t._s(t.item.confirmer.join(",")))]):t._e()]),n("div",{staticClass:"flex y-center f-12"},[n("div",[t._v("截止时间: "+t._s(t.item.endtime))])])]),n("div",{staticClass:"listitem-extra",attrs:{slot:"extra"},slot:"extra"},[n("a-button",{attrs:{type:"link",icon:"edit"},on:{click:function(e){return e.stopPropagation(),t.edit(t.item)}}}),n("a-button",{attrs:{type:"link",icon:"delete"},on:{click:function(e){return e.stopPropagation(),t.remove(t.item)}}})],1)])},O=[],w={name:"plan-item",data:function(){return{list:[],objName:"plandoc",tagMap:{0:{},1:{label:"周",color:"blue"},2:{label:"月",color:"purple"}}}},props:{item:{type:Object}},methods:{getTagConf:function(t){switch(t.type){case 1:return{label:"周",color:"blue"};case 2:return{label:"月",color:"purple"};default:return{label:"计划",color:"green"}}},edit:function(){},remove:function(t,e){var n=this;this.$http.removeOne(this.objName,t._id).end((function(r){r||(e?e(n):n.$emit("removed",t))}))},gotoDetail:function(){this.$router.push({path:"/plan/detail",query:{_id:this.item._id}})}}},k=w,j=(n("2b2e"),Object(v["a"])(k,_,O,!1,null,"3aa990f3",null)),P=j.exports,C={provide:function(){return{workRoot:this}},components:{PlanItem:P},data:function(){return{list:[],objName:"plandoc"}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$d.user.userid&&this.$http.readList(this.objName,{query:{creator:this.$d.user.userid}}).end((function(e,n){e||(t.list=n.body.data)}))},addPlan:function(){var t=this;this.$appLayout.showModal({content:g,title:"添加计划",onEnd:function(e,n){console.log(e,n),t.initList(),t.$appLayout.closeModal()}})},handleRemoved:function(t){var e=this.list.findIndex((function(e){return e._id===t._id}));this.list.splice(e,1)}}},x=C,E=(n("d926"),Object(v["a"])(x,r,o,!1,null,"b453f7ee",null));e["default"]=E.exports},"60fe":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r={plan:"plandoc",work:"workdoc",log:"logdoc"}},"7b8f":function(t,e,n){},"956a":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-form-model",t._b({staticClass:"reset-form-item-div",attrs:{form:t.form,layout:"horizontal"}},"a-form-model",t.formItemLayout,!1),[t.form._id?n("a-form-model-item",{attrs:{label:""}},[n("a-button",{staticClass:"mr10",attrs:{type:"primary"}},[t._v("标记为完成")])],1):t._e(),n("a-form-model-item",{attrs:{label:"任务名称"}},[n("a-input",{attrs:{"read-only":t.form.id,placeholder:"（必填）"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("a-form-model-item",{attrs:{label:"负责人"}},[n("span",[t._v(t._s(t.form.charger))]),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseCharger()}}},[t._v("选择负责人")])],1),n("a-form-model-item",{attrs:{label:"确认人"}},[t._l(t.form.confirmer,(function(e){return n("span",{key:e},[t._v(t._s(e))])})),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseConfirmer()}}},[t._v("选择确认人")])],2),n("a-form-model-item",{attrs:{label:"任务描述"}},[n("a-textarea",{attrs:{rows:2,placeholder:"（选填）"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),n("a-form-model-item",{attrs:{label:"开始时间",extra:"设定一个具体的时间有助于任务的有效执行"}},[n("a-date-picker",{attrs:{showTime:""},model:{value:t.form.begintime,callback:function(e){t.$set(t.form,"begintime",e)},expression:"form.begintime"}})],1),n("a-form-model-item",{attrs:{label:"截至时间"}},[n("a-date-picker",{attrs:{showTime:""},model:{value:t.form.endtime,callback:function(e){t.$set(t.form,"endtime",e)},expression:"form.endtime"}})],1),n("storm-footer",{attrs:{loading:t.submiting},on:{ok:function(e){return t.handleOk()},cancel:function(e){return t.$emit("cancel")}}},[t.form._id?t._e():n("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleOk(!0)}}},[t._v("保存并继续新增")])],1)],1)},o=[],i=n("ed08"),a=n("ad5c"),s=n("60fe");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f={props:{afterFormMounted:{type:Function,default:function(){}},onEnd:{type:Function,default:function(){}}},data:function(){return{form:new a["c"],objName:s["a"].work,formItemLayout:{labelCol:{span:4},wrapperCol:{span:14}},submiting:!1}},mounted:function(){this.afterFormMounted&&this.afterFormMounted(this)},methods:{chooseCharger:function(){var t=this;this.choosePeoples(!1,(function(e){e&&e.length>0&&(t.form.charger=e[0].userid)}))},chooseConfirmer:function(){var t=this;this.choosePeoples(!0,(function(e){t.form.confirmer=e.map((function(t){return t.userid}))}))},choosePeoples:function(t,e){var n=Object(i["a"])();n.choosePeoples(t,e)},handleOk:function(t){var e=l({},this.form),n=this.form._id;e.begintime&&(e.begintime=e.begintime.valueOf()),e.endtime&&(e.endtime=e.endtime.valueOf()),this.submiting=!0,n?this.handleUpdate(e):this.handleAdd(t,e)},handleAdd:function(t,e){var n=this;this.$http.createOne(this.objName,e).end((function(r,o){if(n.submiting=!1,r)console.log("err",r);else if(n.onEnd&&n.onEnd(r,o),t?n.form=(new a["c"]).extend(e):n.$emit("cancel"),!r){var s=o.body.data[0],c=Object(i["a"])();c.notifyChargerCreate({_id:s._id,obj:n.objName})}}))},handleUpdate:function(t){var e=this;this.$http.updateOne(this.objName,t).end((function(t,n){e.submiting=!1,e.onEnd&&e.onEnd(t,n)}))}}},m=f,d=n("2877"),h=Object(d["a"])(m,r,o,!1,null,null,null);e["a"]=h.exports},ad5c:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return $}));var i=function t(){r(this,t),o(this,"_id",null),o(this,"_from",null),o(this,"_fromid",null),o(this,"type",0),o(this,"creator",""),o(this,"receiver",""),o(this,"confirmer",[]),o(this,"charger",""),o(this,"name",""),o(this,"description",""),o(this,"begintime",null),o(this,"endtime",null),o(this,"works",[]),o(this,"progress",0),o(this,"status",0)},a=n("60fe"),s=n("c1df"),c=n.n(s);function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=function(){function t(){l(this,t),m(this,"_id",null),m(this,"_from",null),m(this,"_fromid",null),m(this,"_createtime",null),m(this,"parent","top"),m(this,"creator",""),m(this,"confirmer",[]),m(this,"charger",""),m(this,"name",""),m(this,"description",""),m(this,"begintime",null),m(this,"endtime",null),m(this,"taskhour",0),m(this,"simplereason",""),m(this,"progress",0),m(this,"status",0)}return f(t,[{key:"fromPlan",value:function(t){if(!t)throw new Error("请提供 plan");return this._from=a["a"].plan,this._fromid=t,this}},{key:"fromWork",value:function(t){if(!t)throw new Error("请提供 work 对象");return this._from=t._from,this._fromid=t._fromid,this.parent=t._id,this}},{key:"parse",value:function(t){var e=this;return Object.keys(this).forEach((function(n){"undefined"!==typeof t[n]&&(e[n]=t[n])})),this.parseTime()}},{key:"extend",value:function(t){return this._from=t._from,this._fromid=t._fromid,this.parent=t.parent,this.charger=t.charger,this.confirmer=t.confirmer,t.endtime&&(this.begintime=c()(t.endtime)),this}},{key:"parseTime",value:function(){return this.begintime=this.begintime?c()(this.begintime):null,this.endtime=this.endtime?c()(this.endtime):null,this}},{key:"checkStatus",value:function(){100===this.progress&&0===this.status?this.confirmer.length>0?this.status=10:this.status=20:this.progress&&(this.status=0)}},{key:"toJSON",value:function(){var t=this,e={};return Object.keys(this).forEach((function(n){"function"!==typeof t[n]&&(e[n]=t[n])})),e.begintime=c()(this.begintime).valueOf(),e.endtime=c()(this.endtime).valueOf(),e}}]),t}();function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=function t(){h(this,t),p(this,"_id",""),p(this,"_from",""),p(this,"_fromid",""),p(this,"_createtime",null),p(this,"creator","")};function v(t){return v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),t}function O(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function k(t){var e=C();return function(){var n,r=x(t);if(e){var o=x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(t,e){return!e||"object"!==v(e)&&"function"!==typeof e?P(t):e}function P(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function C(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $=function(t){O(n,t);var e=k(n);function n(){var t;y(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o)),E(P(t),"oldValue",null),E(P(t),"newValue",null),E(P(t),"fromname",null),t}return _(n,[{key:"fromWork",value:function(t,e){return this._from=a["a"].work,this._fromid=t._id,this.oldValue=t.progress,this.newValue=e,this.fromname=t.name,this}},{key:"send",value:function(t){t.createOne(a["a"].log,this).end()}}]),n}(b)},b1ba:function(t,e,n){},d926:function(t,e,n){"use strict";n("b1ba")}}]);