(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-989a41a4"],{"1eaa":function(t,e,n){},"60fe":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={plan:"plandoc",work:"workdoc",log:"logdoc"}},6203:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"header flex between y-center"},[n("div",{staticClass:"title"},[n("span",[t._v(t._s(t.title))])]),n("a-radio-group",{attrs:{"default-value":"a","button-style":"solid"}},[n("a-radio-button",{attrs:{value:"a"}},[t._v("列表视图")]),n("a-radio-button",{attrs:{value:"b"}},[t._v("时间视图")])],1)],1),n("div",{staticClass:"work-list"},[t.workListOn?n("transition-group",{attrs:{name:"list-complete",tag:"div"}},t._l(t.list,(function(e){return n("work-item",{key:e._id,attrs:{"no-child":t.noChild,item:e},on:{"refresh-list":t.initList,change:t.itemChange}})})),1):t._e(),0!==t.list.length||t.loading?t._e():n("a-empty",{attrs:{imageStyle:{"margin-top":"20vh"},description:"暂无此类任务"}})],1)])},r=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"list-complete-item"},[n("div",{staticClass:"anim mb5 flex y-center between work-item hover-shadow reset-listitem-extra",class:{"work-item-delayed":t.hasDelay(t.item),"no-child":t.noChild}},[n("div",{staticClass:"flex y-center"},[t.noChild?t._e():n("div",{staticClass:"fold-icon-box no-shrink flex x-center y-center"},[n("a-button",{attrs:{type:"link",icon:t.isShowChildren?"caret-down":"caret-right"},on:{click:function(e){return t.toggleShowChildren()}}})],1),n("div",{staticClass:"title link anim flex y-center",on:{click:t.edit}},[n("span",{staticClass:"mr10"},[t._v(t._s(t.item.name))])])]),n("div",{staticClass:"listitem-extra no-shrink",attrs:{slot:"extra"},slot:"extra"},[n("a-popover",{attrs:{placement:"left",title:"更新进度"}},[n("template",{slot:"content"},[n("div",{staticStyle:{width:"300px"}},[n("div",{staticClass:"flex y-center"},[n("a-slider",{staticStyle:{width:"100%",margin:"0 20px"},attrs:{max:t.progressMax},model:{value:t.localProgress,callback:function(e){t.localProgress=e},expression:"localProgress"}}),n("a-button",{staticClass:"no-shrink",attrs:{type:"primary"},on:{click:function(e){return t.handleUpdateProgress()}}},[t._v("提交")])],1)])]),n("a-progress",{staticClass:"reset-progress-text pointer",attrs:{width:30,type:"circle",percent:t.item.progress}})],2),t.noChild?t._e():n("a-button",{attrs:{type:"link",icon:"plus-circle"},on:{click:function(e){return e.stopPropagation(),t.addChild(t.item)}}},[t._v("子任务")]),n("a-popconfirm",{attrs:{title:"确认删除这个任务?删除后不可恢复","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(e){return t.remove(t.item)}}},[n("a-button",{attrs:{type:"link",icon:"delete"}})],1)],1)]),t.list.length>0&&!t.noChild?[n("a-list",{directives:[{name:"show",rawName:"v-show",value:t.isShowChildren,expression:"isShowChildren"}],staticClass:"is-child-item",attrs:{"data-source":t.list},scopedSlots:t._u([{key:"renderItem",fn:function(e){return n("work-item",{attrs:{item:e},on:{"refresh-list":t.getChildren,change:t.itemChange}})}}],null,!1,1608409570)})]:t.reading||!t.isShowChildren||0!==t.list.length||t.noChild?t._e():[n("div",{staticClass:"no-data"},[t._v("no data")])]],2)},a=[],s=n("956a"),l=n("ad5c"),c={name:"work-item",data:function(){return{list:[],objName:"workdoc",isShowChildren:!1,localProgress:0,progressMax:100,submiting:!1,reading:!1}},props:{item:{type:Object},noChild:{type:Boolean,default:!1}},created:function(){this.localProgress=this.item.progress},methods:{hasDelay:function(t){return!(0!==t.status||!t.endtime)&&Date.now()>t.endtime},getChildren:function(){var t=this;this.reading=!0,this.$http.readList(this.objName,{query:{parent:this.item._id},sort:{_createtime:-1}}).end((function(e,n){t.reading=!1,e||(t.list=n.body.data)}))},addChild:function(){var t=this;this.$appLayout.showDrawer({title:"添加子任务",content:s["a"],afterFormMounted:function(e){e.form.fromWork(t.item)},onEnd:function(){t.getChildren(),t.showChildren()}})},edit:function(){var t=this;this.$appLayout.showDrawer({title:"编辑任务",content:s["a"],afterFormMounted:function(e){e.form.parse(t.item)},onEnd:function(){t.refreshSelf(),t.$appLayout.closeDrawer()}})},remove:function(t,e){var n=this;this.$http.removeOne(this.objName,t._id).end((function(t){t||(e?e(n):n.$emit("refresh-list"))}))},toggleShowChildren:function(t){this.isShowChildren="boolean"===typeof t?t:!this.isShowChildren,this.isShowChildren&&this.getChildren()},showChildren:function(){this.isShowChildren=!0},hurry:function(t){this.$http.post(this.$http.baseDir+"third/dd/hurry-work",t).end((function(t,e){console.log(t,e)}))},refreshSelf:function(){var t=this;this.$http.readOne(this.objName,this.item._id).end((function(e,n){!e&&n.body&&t.$emit("change",n.body.data)}))},itemChange:function(t){var e=this.list.findIndex((function(e){return e._id===t._id}));this.list.splice(e,1,t)},handleUpdateProgress:function(){var t=this,e=(new l["c"]).parse(this.item);e.progress=this.localProgress,e.checkStatus(),e.progress!==this.item.progress&&(this.submiting=!0,this.$http.updateOne(this.objName,e.toJSON()).end((function(){t.submiting=!1,t.$emit("refresh-list")})),(new l["b"]).fromWork(this.item,e.progress).send(this.$http))}}},u=c,f=(n("ae91"),n("2877")),h=Object(f["a"])(u,o,a,!1,null,"4c62f754",null),d=h.exports;function m(t){return g(t)||y(t)||b(t)||p()}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(t,e){if(t){if("string"===typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function y(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function g(t){if(Array.isArray(t))return v(t)}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var w={components:{WorkItem:d},props:{title:{type:String,default:""},getQuery:{type:Function,default:function(){return{_id:"public"}}},getSort:{type:Function,default:function(){return{_createtime:-1}}},getSkip:{type:Function,default:function(){}},getLimit:{type:Function,default:function(){return 50}},noChild:{type:Boolean,default:!1}},data:function(){return{list:[],objName:"workdoc",workListOn:!0,loading:!1}},created:function(){this.forceInitList()},methods:{loadMore:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$d.user.userid&&(this.loading=!0,this.$http.readList(this.objName,{query:Object.assign(this.mixNextPageQuery(e),this.getQuery(this)),sort:this.getSort(this),skip:this.getSkip(this),limit:this.getLimit(this)}).end((function(n,i){t.loading=!1,e.clearAll&&(t.list=[]),!n&&i.body&&i.body.data&&i.body.data.length>0&&(t.list=[].concat(m(t.list),m(i.body.data))),e.onLoad&&e.onLoad(n,i)})))},mixNextPageQuery:function(t){var e=this.list.slice(-1)[0];return e&&e._createtime&&!t.clearAll?{_createtime:{$lt:e._createtime}}:{}},initList:function(){this.loadMore({clearAll:!0})},forceInitList:function(){var t=this;this.workListOn=!1,this.list=[],this.loadMore({onLoad:function(){t.workListOn=!0}})},itemChange:function(t){var e=this.list.findIndex((function(e){return e._id===t._id}));this.list.splice(e,1,t)}}},_=w,k=(n("6d94"),Object(f["a"])(_,i,r,!1,null,"57ec94d6",null));e["a"]=k.exports},"6d94":function(t,e,n){"use strict";n("77f2")},"77f2":function(t,e,n){},"956a":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-form-model",t._b({staticClass:"reset-form-item-div",attrs:{form:t.form,layout:"horizontal"}},"a-form-model",t.formItemLayout,!1),[t.form._id?n("a-form-model-item",{attrs:{label:""}},[n("a-button",{staticClass:"mr10",attrs:{type:"primary"}},[t._v("标记为完成")])],1):t._e(),n("a-form-model-item",{attrs:{label:"任务名称"}},[n("a-input",{attrs:{"read-only":t.form.id,placeholder:"（必填）"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("a-form-model-item",{attrs:{label:"负责人"}},[n("span",[t._v(t._s(t.form.charger))]),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseCharger()}}},[t._v("选择负责人")])],1),n("a-form-model-item",{attrs:{label:"确认人"}},[t._l(t.form.confirmer,(function(e){return n("span",{key:e},[t._v(t._s(e))])})),n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.chooseConfirmer()}}},[t._v("选择确认人")])],2),n("a-form-model-item",{attrs:{label:"任务描述"}},[n("a-textarea",{attrs:{rows:2,placeholder:"（选填）"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),n("a-form-model-item",{attrs:{label:"开始时间",extra:"设定一个具体的时间有助于任务的有效执行"}},[n("a-date-picker",{attrs:{showTime:""},model:{value:t.form.begintime,callback:function(e){t.$set(t.form,"begintime",e)},expression:"form.begintime"}})],1),n("a-form-model-item",{attrs:{label:"截至时间"}},[n("a-date-picker",{attrs:{showTime:""},model:{value:t.form.endtime,callback:function(e){t.$set(t.form,"endtime",e)},expression:"form.endtime"}})],1),n("storm-footer",{attrs:{loading:t.submiting},on:{ok:function(e){return t.handleOk()},cancel:function(e){return t.$emit("cancel")}}},[t.form._id?t._e():n("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleOk(!0)}}},[t._v("保存并继续新增")])],1)],1)},r=[],o=n("ed08"),a=n("ad5c"),s=n("60fe");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f={props:{afterFormMounted:{type:Function,default:function(){}},onEnd:{type:Function,default:function(){}}},data:function(){return{form:new a["c"],objName:s["a"].work,formItemLayout:{labelCol:{span:4},wrapperCol:{span:14}},submiting:!1}},mounted:function(){this.afterFormMounted&&this.afterFormMounted(this)},methods:{chooseCharger:function(){var t=this;this.choosePeoples(!1,(function(e){e&&e.length>0&&(t.form.charger=e[0].userid)}))},chooseConfirmer:function(){var t=this;this.choosePeoples(!0,(function(e){t.form.confirmer=e.map((function(t){return t.userid}))}))},choosePeoples:function(t,e){var n=Object(o["a"])();n.choosePeoples(t,e)},handleOk:function(t){var e=c({},this.form),n=this.form._id;e.begintime&&(e.begintime=e.begintime.valueOf()),e.endtime&&(e.endtime=e.endtime.valueOf()),this.submiting=!0,n?this.handleUpdate(e):this.handleAdd(t,e)},handleAdd:function(t,e){var n=this;this.$http.createOne(this.objName,e).end((function(i,r){if(n.submiting=!1,i)console.log("err",i);else if(n.onEnd&&n.onEnd(i,r),t?n.form=(new a["c"]).extend(e):n.$emit("cancel"),!i){var s=r.body.data[0],l=Object(o["a"])();l.notifyChargerCreate({_id:s._id,obj:n.objName})}}))},handleUpdate:function(t){var e=this;this.$http.updateOne(this.objName,t).end((function(t,n){e.submiting=!1,e.onEnd&&e.onEnd(t,n)}))}}},h=f,d=n("2877"),m=Object(d["a"])(h,i,r,!1,null,null,null);e["a"]=m.exports},ad5c:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return $}));var o=function t(){i(this,t),r(this,"_id",null),r(this,"_from",null),r(this,"_fromid",null),r(this,"type",0),r(this,"creator",""),r(this,"receiver",""),r(this,"confirmer",[]),r(this,"charger",""),r(this,"name",""),r(this,"description",""),r(this,"begintime",null),r(this,"endtime",null),r(this,"works",[]),r(this,"progress",0),r(this,"status",0)},a=n("60fe"),s=n("c1df"),l=n.n(s);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=function(){function t(){c(this,t),h(this,"_id",null),h(this,"_from",null),h(this,"_fromid",null),h(this,"_createtime",null),h(this,"parent","top"),h(this,"creator",""),h(this,"confirmer",[]),h(this,"charger",""),h(this,"name",""),h(this,"description",""),h(this,"begintime",null),h(this,"endtime",null),h(this,"taskhour",0),h(this,"simplereason",""),h(this,"progress",0),h(this,"status",0)}return f(t,[{key:"fromPlan",value:function(t){if(!t)throw new Error("请提供 plan");return this._from=a["a"].plan,this._fromid=t,this}},{key:"fromWork",value:function(t){if(!t)throw new Error("请提供 work 对象");return this._from=t._from,this._fromid=t._fromid,this.parent=t._id,this}},{key:"parse",value:function(t){var e=this;return Object.keys(this).forEach((function(n){"undefined"!==typeof t[n]&&(e[n]=t[n])})),this.parseTime()}},{key:"extend",value:function(t){return this._from=t._from,this._fromid=t._fromid,this.parent=t.parent,this.charger=t.charger,this.confirmer=t.confirmer,t.endtime&&(this.begintime=l()(t.endtime)),this}},{key:"parseTime",value:function(){return this.begintime=this.begintime?l()(this.begintime):null,this.endtime=this.endtime?l()(this.endtime):null,this}},{key:"checkStatus",value:function(){100===this.progress&&0===this.status?this.confirmer.length>0?this.status=10:this.status=20:this.progress&&(this.status=0)}},{key:"toJSON",value:function(){var t=this,e={};return Object.keys(this).forEach((function(n){"function"!==typeof t[n]&&(e[n]=t[n])})),e.begintime=l()(this.begintime).valueOf(),e.endtime=l()(this.endtime).valueOf(),e}}]),t}();function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=function t(){m(this,t),p(this,"_id",""),p(this,"_from",""),p(this,"_fromid",""),p(this,"_createtime",null),p(this,"creator","")};function y(t){return y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function w(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),t}function _(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}function k(t,e){return k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},k(t,e)}function O(t){var e=x();return function(){var n,i=S(t);if(e){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return C(this,n)}}function C(t,e){return!e||"object"!==y(e)&&"function"!==typeof e?j(t):e}function j(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function S(t){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},S(t)}function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $=function(t){_(n,t);var e=O(n);function n(){var t;g(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r)),P(j(t),"oldValue",null),P(j(t),"newValue",null),P(j(t),"fromname",null),t}return w(n,[{key:"fromWork",value:function(t,e){return this._from=a["a"].work,this._fromid=t._id,this.oldValue=t.progress,this.newValue=e,this.fromname=t.name,this}},{key:"send",value:function(t){t.createOne(a["a"].log,this).end()}}]),n}(b)},ae91:function(t,e,n){"use strict";n("1eaa")}}]);